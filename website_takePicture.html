<!DOCTYPE html>
<html>
    <head>
	<link rel="stylesheet" type="text/css" href="website.css">
        <meta charset="utf-8">
        <meta content="stuff, to, help, search, engines, not" name="keywords">
        <meta content="What this page is about." name="description">
        <title>Display Webcam Stream</title>

        <style>
            #container {
                margin: 0px auto;
                width: 500px;
                height: 375px;
                border: 10px #333 solid;
            }
            #videoElement {
                width: 500px;
                height: 375px;
                background-color: #666;
            }
        </style>

        <script src="js/jquery-3.1.1.min.js"></script>
        <script>
            $(document).ready(function () {
                var video = document.querySelector("#videoElement");
                //var uploadURL = "http://toinsson.pythonanywhere.com/upload";
                var uploadURL = "http://localhost:5000/upload";
                navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia || navigator.oGetUserMedia;
                if (navigator.getUserMedia) {
                    navigator.getUserMedia({video: true}, handleVideo, videoError);
                }
                function handleVideo(stream) {
                    video.src = window.URL.createObjectURL(stream);
                }
                function videoError(e) {
                    // do something
                }
                var canvas = document.createElement('canvas');
                canvas.width = 1024;
                canvas.height = 768;
                var ctx = canvas.getContext('2d');
                function takePicture() {
                    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                }
                function uploadPicture() {
                    $.post(uploadURL,
                            {
                                file: canvas.toDataURL('image/jpeg')
                            },
                            function (data) {
                                // we need to call game page!!
                                console.log("reply: " + data);
                            });
                }
                var takePicButton = document.getElementById('takeButton');
                var uploadPicButton = document.getElementById('uploadButton');
                takePicButton.addEventListener("click", takePicture);
                uploadPicButton.addEventListener("click", uploadPicture);
                var imageLoader = document.getElementById('imageLoader');
                imageLoader.addEventListener('change', handleImage, false);
                function handleImage(e) {
                    var reader = new FileReader();
                    reader.onload = function (event) {
                        var img = new Image();
                        img.onload = function () {
                            canvas.width = img.width;
                            canvas.height = img.height;
                            ctx.drawImage(img, 0, 0);
                        }
                        img.src = event.target.result;
                    }
                    reader.readAsDataURL(e.target.files[0]);
                }
            });
        </script>
    </head>

    <body>
        <div id="container">
            <video autoplay="true" id="videoElement">

            </video>
            <div>
                <button id="takeButton">Take Picture</button>
                <input type="file" id="imageLoader" multiple="multiple" accept="image/*" />
            </div>
            <div>
                <button id="uploadButton">Upload Picture</button>
            </div>
        </div>
		<ul id ="Play">
  <li><a href="website_game.html" class="round green">Play<span class="round">Let's go!</span></a></li>
</ul>
    </body>
</html>